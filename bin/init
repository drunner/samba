#!/bin/bash
DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
. $DIR/bash.conf

RVAL=3

function ensurevolexists {
  docker volume ls | grep $1 > /dev/null
  if [ $? -ne 0 ] ; then
     echo Creating volume $1
     docker volume create --name $1
     echo docker run -v "$1:/tempmount" ${CONTAINER_NAME} "/usr/local/bin/docker-$1-populate"
     docker run --name sambaconfig -v "$1:/tempmount" ${CONTAINER_NAME} "/usr/local/bin/docker-$1-populate"
     docker rm sambaconfig
     RVAL=0
  fi
}

ensurevolexists samba-etc
ensurevolexists samba-extrausers
ensurevolexists samba-varlib

if [ "$RVAL" = 3 ]; then
   echo "All volumes already initialised."
fi

exit $RVAL
